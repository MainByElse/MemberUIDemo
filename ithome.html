<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>会员中心</title>
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="referrer" content="origin-when-crossorigin" />
        <meta name="theme-color" content="#fff" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="white" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <link href="../../css/app/common.css" rel="stylesheet" />
        <link href="../../css/app/vip/ithome.min.css?v=1" rel="stylesheet" />
        <link href="./common.css" rel="stylesheet" />
        <link href="./ithome.css" rel="stylesheet" />
        <link
            href="https://cdn.jsdelivr.net/npm/swiper@5.3.6/css/swiper.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"
            rel="stylesheet"
        />
        <style>
            [v-cloak] {
                display: none;
            }
        </style>
        <script>
            var ua = navigator.userAgent;
            var htmlClass = '';
            if (navigator.userAgent.match(/(\/night)/i)) {
                htmlClass = 'night';
            }
            document.documentElement.className = htmlClass;
        </script>
        <script src="https://cdn.jsdelivr.net/npm/swiper@5.3.6/js/swiper.min.js"></script>
        <script src="https://doc.ruanmei.com/wp-content/themes/mywiki/js/rm-js-sdk.js"></script>
        <script src="../../js/app/common.min.js"></script>
        <script src="https://s1.pstatp.com/cdn/expire-1-M/vue/2.6.10/vue.js"></script>
        <script>
            window.Vue ||
                document.write(
                    "<script src='https:\/\/img.ruanmei.com\/btd\/cdn\/expire-1-M\/vue\/2.6.10\/vue.min.js'><\/script>",
                );
        </script>
        <script src="https://s1.pstatp.com/cdn/expire-1-M/vue-lazyload/1.2.6/vue-lazyload.js"></script>
        <script>
            VueLazyload ||
                document.write(
                    "<script src='https:\/\/img.ruanmei.com\/btd\/cdn\/expire-1-M\/vue-lazyload\/1.2.6\/vue-lazyload.js'><\/script>",
                );
        </script>
        <script src="https://cdn.jsdelivr.net/npm/vue-awesome-swiper"></script>
    </head>

    <body>
        <div
            id="page-box"
            class="page-box"
            v-bind:class="pageBoxClass"
            v-cloak
            v-lazy-container="{ selector: 'img[lazy=true]' }"
        >
            <div class="open-vip" v-if="!userInfo.isVip">
                <h1>开通IT之家黄金会员</h1>
                <p>享四大权限</p>
                <button @click="buyVip" v-bind:class="{ disabled:nobuyVip }">
                    <span>¥</span>{{vipPrice.yearGold}}/年 立即开通
                </button>
            </div>
            <div class="vip-info" v-else>
                <div class="card">
                    <div class="user">
                        <img
                            class="head-img"
                            lazy="true"
                            v-lazy="userHead"
                            data-error="//img.ithome.com/m/images/user/noavatar.png"
                        />
                        <div class="">
                            <span>{{userInfo.nickname}}</span>
                            <div>
                                <img
                                    class="vip-mark"
                                    src="data:image/svg+xml;base64,PHN2ZyBpZD0iXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDExNS4xIDEyMCI+PHN0eWxlPjwvc3R5bGU+PHBhdGggZD0iTTU0IDg3LjNjLjMuMy44LjggMS4zIDEtLjUtLjItMS4xLS41LTEuMy0xIiBmaWxsPSIjZmZlMjdmIi8+PHBhdGggZD0iTTIuNSAxOC4xVjUzYy4xLS45LjMtMS44LjktMi42bDIwLjItMjkuOGMxLTEuNiAyLjktMi40IDQuNC0yLjRoNTljMS44IDAgMy40LjggNC41IDIuNGwyMC4yIDI5LjZjMS42IDIuNCAxLjMgNS4yLS44IDcuMWwtNDkuNSA0OC40Yy0yLjEgMi4xLTUuMiAyLjEtNy4zIDBMNC4yIDU3LjVjLTEuMS0xLjEtMS43LTIuNi0xLjctNC4xdjU0aDExMFYxOC4xSDIuNXoiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNNTQgMTA1LjZjMi4xIDIuMSA1LjIgMi4xIDcuMyAwbDQ5LjUtNDguNGMyLjEtMS44IDIuNC00LjcuOC03LjFMOTEuNCAyMC42Yy0xLTEuNi0yLjYtMi40LTQuNS0yLjRIMjguMWMtMS42IDAtMy40LjgtNC40IDIuNEwzLjUgNTAuNGMtLjYuOC0uOSAxLjctLjkgMi42di4zYzAgMS41LjYgMy4xIDEuNyA0LjFMNTQgMTA1LjZ6TTM4LjUgNjIuN2MuOCAwIDEuOC4zIDIuNiAxTDU3LjYgODBsMTctMTYuMmMuNS0uNSAxLjYtMSAyLjYtMSAzLjQgMCA1LjIgNC41IDIuNiA2LjhMNjEuNiA4Ny4zYy0xIDEtMi40IDEuNi0zLjcgMS42aC0xYy0uMyAwLS44LS4zLTEuMy0uNS0uNS0uMy0xLS44LTEuMy0xTDM1LjkgNjkuNWMtMi42LTIuNi0uOC02LjggMi42LTYuOHoiIGZpbGw9IiNkMjIyMjIiLz48L3N2Zz4="
                                />
                                <p class="expire">{{vipExpire}}</p>
                            </div>
                        </div>
                        <p></p>
                        <button
                            @click="buyVip"
                            v-if="systemInfo.platform !=='iOS'"
                            v-bind:class="{ disabled:nobuyVip }"
                        >
                            立刻续费
                        </button>
                    </div>
                    <div class="info">
                        <div>
                            <span>Lv.{{userInfo.rank}}</span>
                            <p>等级</p>
                        </div>
                        <div>
                            <span>{{medalCount}}</span>
                            <p>勋章</p>
                        </div>
                        <div>
                            <span>{{userInfo.coin}}</span>
                            <p>金币</p>
                        </div>
                    </div>
                </div>
                <div class="on-off">
                    <div class="title">权益开关</div>
                    <div class="on-off-item">
                        <div>
                            <span>去广告</span>
                            <p>信息流及文章底部</p>
                        </div>
                        <!--<button></button>-->
                        <a href="ithome://setting?option=display">去设置</a>
                    </div>
                    <!--<div class="on-off-item">
                    <div><span>去文章页面相关新闻</span></div>
                    <button class="active"></button>
                    <a href="ithome://setting?option=display">去设置</a>
                </div>-->
                </div>
            </div>
            <div class="vip-benefits">
                <div class="title">
                    <h3>会员权益</h3>
                </div>
                <div class="benefits">
                    <div
                        class="benefits-item"
                        v-for="(item, index) in introductions"
                        @click.stop="benefitsItemClick(index)"
                        :key="index"
                    >
                        <img :src="item.headerUrl" />
                        <p>{{item.title}}</p>
                    </div>
                </div>
            </div>
            <div class="vip-introduction-container" v-if="introductionDisplay">
                <div class="dimming" @click="introductionMaskClick"></div>
                <swiper class="swiper-container" :options="swiperOptions">
                    <swiper-slide
                        class="swiper-slide-container"
                        :key="index"
                        v-for="(item, index) in introductions"
                    >
                        <div class="swiper-item">
                            <img class="header" :src="item.headerUrl" />
                            <p class="title">{{item.title}}</p>
                            <p class="desc">{{item.desc}}</p>
                            <div class="card-container">
                                <p>占位</p>
                            </div>
                        </div>
                    </swiper-slide>
                </swiper>
                <div class="close" @click="introductionMaskClick">叉号</div>
            </div>
        </div>
        <script>
            Vue.use(VueAwesomeSwiper);
            Vue.use(VueLazyload, {
                preLoad: 1.2,
                attempt: 3,
            });
            var vue = new Vue({
                el: '#page-box',
                data: {
                    pageBoxClass: ' hide',
                    nobuyVip: false,
                    vipPrice: {
                        yearGold: 98,
                    },
                    systemInfo: {
                        platform: '',
                    },
                    userInfo: {
                        vip: '0000000',
                        isVip: false,
                        vipClass: '',
                        vipendtime: '1900-01-01T:00:00:00',
                        nickname: '软媒用户',
                        rank: 0,
                        medal: '',
                        coin: 0,
                        userid: 0,
                    },
                    swiperOptions: {
                        loop: false,
                        slidesPerView: 1.4,
                        spaceBetween: 15,
                        centeredSlides: true,
                        initialSlide: 0,
                    },
                    introductionDisplay: false,
                    introductions: [
                        {
                            title: '会员标识',
                            desc: '专属标识，彰显你的与众不同',
                            headerUrl:
                                'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201804%2F30%2F20180430134113_gphba.jpg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1619664355&t=955b19496dd4ddb86468167b43ac8343',
                        },
                        {
                            title: '去广告',
                            desc: '可关闭信息流及文章底部广告',
                            headerUrl:
                                'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201804%2F30%2F20180430134113_gphba.jpg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1619664355&t=955b19496dd4ddb86468167b43ac8343',
                        },
                        {
                            title: '修改昵称',
                            desc: '可在不使用更名卡的情况下无限制修改昵称',
                            headerUrl:
                                'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201804%2F30%2F20180430134113_gphba.jpg&refer=http%3A%2F%2Fb-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1619664355&t=955b19496dd4ddb86468167b43ac8343',
                        },
                    ],
                },
                computed: {
                    userHead: function () {
                        var that = this;
                        var userid = that.userInfo.userid + '';
                        while (userid.length < 9) {
                            userid = '0' + userid;
                        }
                        var userHeadImg =
                            'https://avatar.ithome.com/avatars/' +
                            userid.substr(0, 3) +
                            '/' +
                            userid.substr(3, 2) +
                            '/' +
                            userid.substr(5, 2) +
                            '/' +
                            userid.substr(7, 2) +
                            '_avatar.jpg';
                        return userHeadImg;
                    },
                    vipExpire: function () {
                        var that = this;
                        var expire = '已到期';
                        if (that.userInfo.isVip) {
                            expire =
                                ParseNetJsonDateFmt(
                                    that.userInfo.vipendtime,
                                    'yyyy-MM-dd',
                                ) + ' 到期';
                        }
                        return expire;
                    },
                    medalCount: function () {
                        var that = this;
                        var medalCount = 0;
                        for (var k = 0; k < that.userInfo.medal.length; k++)
                            if (((that.userInfo.medal >> k) & 1) === 1)
                                medalCount++;
                        return medalCount;
                    },
                },
                methods: {
                    buyVip: function () {
                        var that = this;
                        if (that.nobuyVip) return false;
                        that.nobuyVip = true;
                        if (rm.getUserInfoSync().success) {
                            rm.onPageVisibleChanged(function (status) {
                                if (status.show) {
                                    //window.location.reload();
                                    rm.getUserInfo(function (res) {
                                        if (res.success) {
                                            that.userInfo = res.userInfo;
                                            //vip类型判断
                                            var huangjin = 1;
                                            if (
                                                ((that.userInfo.vip >>
                                                    (huangjin - 1)) &
                                                    1) ===
                                                1
                                            ) {
                                                that.userInfo.isVip = true;
                                                that.userInfo.VipClass =
                                                    '黄金会员';
                                            }
                                        }
                                        that.pageBoxClass = '';
                                    });
                                }
                            });
                            rm.navigateTo({
                                url: 'buyvip.html',
                            });
                        } else {
                            rm.login(function (res) {
                                if (res.success) {
                                    that.userInfo = res.userInfo;
                                    //vip类型判断
                                    var huangjin = 1;
                                    if (
                                        ((that.userInfo.vip >> (huangjin - 1)) &
                                            1) ===
                                        1
                                    ) {
                                        that.userInfo.isVip = true;
                                        that.userInfo.VipClass = '黄金会员';
                                    } else {
                                        rm.navigateTo({
                                            url: 'buyvip.html',
                                        });
                                    }
                                }
                            });
                        }
                        that.nobuyVip = false;
                    },
                    benefitsItemClick: function (index) {
                        this.introductionDisplay = !this.introductionDisplay;
                        if (this.introductionDisplay) {
                            this.swiperOptions = {
                                ...this.swiperOptions,
                                initialSlide: index,
                            };
                        }
                    },
                    introductionMaskClick: function () {
                        this.introductionDisplay = false;
                    },
                },
                created: function () {
                    var that = this;
                    rm.ready(function () {
                        rm.hideMenus([
                            'navigation',
                            'openBrowser',
                            'refresh',
                            'share',
                        ]);
                        //夜间模式监听
                        rm.onAppThemeChanged(function (status) {
                            that.isDark = status.isDark;
                            if (that.isDark)
                                document.documentElement.className = 'night';
                            else document.documentElement.className = '';
                        });
                        //系统信息
                        rm.getSystemInfo(function (res) {
                            if (res.success) {
                                that.systemInfo = res.systemInfo;
                            }
                        });
                        //that.pageBoxClass = "";
                        rm.getUserInfo(function (res) {
                            if (res.success) {
                                that.userInfo = res.userInfo;
                                //vip类型判断
                                var huangjin = 1;
                                if (
                                    ((that.userInfo.vip >> (huangjin - 1)) &
                                        1) ===
                                    1
                                ) {
                                    that.userInfo.isVip = true;
                                    that.userInfo.VipClass = '黄金会员';
                                }
                            }
                            that.pageBoxClass = '';
                        });
                    });
                },
            });
        </script>
    </body>
</html>
